---
import Layout from '../layouts/Layout.astro';
import { ProjectsPage } from '../components/ProjectsPage';
import { getCollection } from 'astro:content';

const projectsCollection = await getCollection('projects');

const projects = projectsCollection.map((project) => ({
  id: project.id,
  slug: project.slug,
  title: project.data.title,
  description: project.data.description,
  imageUrl: project.data.coverImage,
  videoUrl: project.data.videoUrl,
  githubUrl: project.data.githubUrl,
  demoUrl: project.data.demoUrl,
  tags: project.data.tags,
}));

const allTags = [...new Set(projects.flatMap((p) => p.tags.map((t) => t.name)))].map((name) => {
  const project = projects.find((p) => p.tags.some((t) => t.name === name));
  const tag = project?.tags.find((t) => t.name === name);
  return { name, color: tag?.color || '#6b7280' };
});
---

<Layout title="Projects | My Portfolio">
  
  <main class="pt-32 pb-16 px-4">
    <div class="max-w-6xl mx-auto">
      <h1 class="text-3xl font-bold mb-8">Projects</h1>
      
      <ProjectsPage projects={projects} allTags={allTags} client:load />
    </div>
  </main>
</Layout>