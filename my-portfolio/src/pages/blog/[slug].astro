---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: post,
  }));
}

const post = Astro.props;
const { Content } = await post.render();
---

<Layout title={`${post.data.title} | Blog`}>
  <main class="pt-32 pb-16 px-4">
    <article class="max-w-6xl mx-auto">
      <!-- Back Button -->
      <a 
        href="/blog" 
        class="inline-flex items-center gap-2 text-[var(--muted-foreground)] hover:text-[var(--foreground)] mb-8 transition-colors"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
        Back to Blog
      </a>
      
      <!-- Header -->
      <header class="mb-8">
        <span
          class="inline-block px-3 py-1 text-sm font-semibold rounded-full mb-4"
          style={{
            'background-color': `${post.data.category.color}20`,
            'color': post.data.category.color,
          }}
        >
          {post.data.category.name}
        </span>
        
        <h1 class="text-4xl font-bold mb-4">{post.data.title}</h1>
        
        <div class="flex items-center gap-4 text-[var(--muted-foreground)]">
          <span class="flex items-center gap-1">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
            {new Date(post.data.publishedAt).toLocaleDateString('en-US', {
              month: 'long',
              day: 'numeric',
              year: 'numeric',
            })}
          </span>
          {post.data.readingTime && (
            <span class="flex items-center gap-1">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
              {post.data.readingTime} min read
            </span>
          )}
        </div>
      </header>
      
      <!-- Cover Image -->
      {post.data.coverImage && (
        <img
          src={post.data.coverImage}
          alt={post.data.title}
          class="w-full rounded-xl mb-8"
        />
      )}
      
      <!-- Content -->
      <div class="neu-flat p-8 rounded-2xl">
        <div class="prose max-w-none">
          <Content />
        </div>
      </div>
    </article>
  </main>
</Layout>

<style>
  .prose h1 {
    font-size: 2rem;
    font-weight: 700;
    margin-top: 2rem;
    margin-bottom: 1rem;
  }
  .prose h2 {
    font-size: 1.5rem;
    font-weight: 700;
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
  }
  .prose h3 {
    font-size: 1.25rem;
    font-weight: 600;
    margin-top: 1.25rem;
    margin-bottom: 0.5rem;
  }
  .prose p {
    margin-bottom: 1rem;
    line-height: 1.75;
  }
  .prose ul, .prose ol {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
  }
  .prose li {
    margin-bottom: 0.5rem;
  }
  /* Inline code styles */
  .prose :global(code) {
    background: var(--card) !important;
    box-shadow: var(--shadow-inset-light), var(--shadow-inset-dark) !important;
    color: var(--foreground) !important;
    padding: 0.25rem 0.5rem !important;
    border-radius: 0.5rem !important;
    font-size: 0.875rem !important;
    font-weight: 600 !important;
  }
  /* Code block styles */
  .prose :global(pre) {
    /* Keep the dark background from the theme but add shape/shadows */
    border-radius: var(--radius) !important;
    box-shadow: inset 0 0 20px rgba(0,0,0,0.5) !important;
    padding: 1.5rem !important;
    overflow-x: auto;
    margin: 2rem 0 !important;
  }
  .prose :global(pre code) {
    background: transparent !important;
    box-shadow: none !important;
    padding: 0 !important;
    font-weight: 400 !important;
    color: inherit !important;
  }
  .prose blockquote {
    border-left: 4px solid var(--foreground);
    padding-left: 1rem;
    margin-left: 0;
    font-style: italic;
    color: var(--muted-foreground);
  }
  .prose img {
    border-radius: 0.75rem;
    margin: 1.5rem 0;
  }
  .prose a {
    color: var(--foreground);
    text-decoration: underline;
  }
</style>
